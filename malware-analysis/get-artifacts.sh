#!/bin/bash
# source get-artifacts.sh
# get-artifacts $tgtPath $resPath

patterns=(
    "HKEY_LOCAL_MACHINE\\Software\\Microsoft" \
    "http[s]?://[a-zA-Z0-9\.-]+\.[a-zA-Z]{2,6}" \
    "C:\\Windows\\System32"
)

get_urls() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-url_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Checking file for URLs: $file"
        results=$(strings "$file" | grep -E 'http[s]?://[a-zA-Z0-9\.-]+\.[a-zA-Z]{2,6}')
        if [[ -n "$results" ]]; then
            echo "===== $file =====" >> "$OutputPath"
            echo "$results" >> "$OutputPath"
        fi
    done
}

get_suspicious_patterns() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-suspicious_strings.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Analyzing file for suspicious patterns: $file"
        for pattern in "${patterns[@]}"; do
            matches=$(strings "$file" | grep -E "$pattern")
            if [[ -n "$matches" ]]; then
                echo "===== $file =====" >> "$OutputPath"
                echo "[+] $pattern -> $matches" >> "$OutputPath"
            fi
        done
    done
}

get_hashes() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-hash_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Processing file for hashes: $file"
        hashMD5=$(md5sum "$file" | awk '{ print $1 }')
        hashSHA1=$(sha1sum "$file" | awk '{ print $1 }')
        hashSHA256=$(sha256sum "$file" | awk '{ print $1 }')

        echo "===== $file =====" >> "$OutputPath"
        echo "MD5: $hashMD5" >> "$OutputPath"
        echo "SHA-1: $hashSHA1" >> "$OutputPath"
        echo "SHA-256: $hashSHA256" >> "$OutputPath"
    done
}

get_ipv4() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-ipv4_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Processing file for IPv4 addresses: $file"
        results=$(strings "$file" | grep -E '\b([0-9]{1,3}\.){3}[0-9]{1,3}\b')
        if [[ -n "$results" ]]; then
            echo "===== $file =====" >> "$OutputPath"
            echo "$results" >> "$OutputPath"
        fi
    done
}

get_ipv6() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-ipv6_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Processing file for IPv6 addresses: $file"
        results=$(strings "$file" | grep -E '([a-fA-F0-9]{1,4}:){7}[a-fA-F0-9]{1,4}')
        if [[ -n "$results" ]]; then
            echo "===== $file =====" >> "$OutputPath"
            echo "$results" >> "$OutputPath"
        fi
    done
}

get_emails() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-email_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Processing file for email addresses: $file"
        results=$(strings "$file" | grep -E '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}')
        if [[ -n "$results" ]]; then
            echo "===== $file =====" >> "$OutputPath"
            echo "$results" >> "$OutputPath"
        fi
    done
}

get_dns() {
    local DirectoryPath="${1:-/path/to/files}"
    local OutputPath="${2:-dns_output.txt}"

    find "$DirectoryPath" -type f | while read -r file; do
        echo "Processing file for DNS: $file"
        results=$(strings "$file" | grep -E '[a-zA-Z0-9\.-]+\.[a-zA-Z]{2,6}')
        if [[ -n "$results" ]]; then
            echo "===== $file =====" >> "$OutputPath"
            echo "$results" >> "$OutputPath"
        fi
    done
}

get-artifacts() {
    local TargetDirectory="${1:-/path/to/malware/samples}"
    local ResultsDirectory="${2:-/path/to/results}"

    if [[ ! -d "$TargetDirectory" ]]; then
        echo "Target directory not found: $TargetDirectory"
        return 1
    fi

    mkdir -p "$ResultsDirectory"

    get_urls "$TargetDirectory" "$ResultsDirectory/url_results.txt"
    get_suspicious_patterns "$TargetDirectory" "$ResultsDirectory/suspicious_results.txt"
    get_hashes "$TargetDirectory" "$ResultsDirectory/hashes_results.txt"
    get_ipv4 "$TargetDirectory" "$ResultsDirectory/ipv4_results.txt"
    get_ipv6 "$TargetDirectory" "$ResultsDirectory/ipv6_results.txt"
    get_emails "$TargetDirectory" "$ResultsDirectory/email_results.txt"
    get_dns "$TargetDirectory" "$ResultsDirectory/dns_results.txt"

    echo "Malware analysis completed. Results saved in $ResultsDirectory."
}

# source get-artifacts.sh
# get-artifacts $tgtPath $resPath